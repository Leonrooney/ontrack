generator client {
  provider = "prisma-client-js"
}

// When using Supabase pooler (port 6543), the app adds ?pgbouncer=true so Prisma
// does not use prepared statements (avoids "prepared statement does not exist" errors).
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model accounts {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  users             users   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model achievements {
  id          String   @id
  userId      String
  title       String
  description String?
  icon        String?
  unlockedAt  DateTime @default(now())
  category    String?
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model activity_entries {
  id           String   @id
  userId       String
  title        String?
  description  String?
  date         DateTime @default(now())
  duration     Int?
  category     String?
  tags         String?
  steps        Int?
  distanceKm   Float?
  calories     Int?
  heartRateAvg Int?
  workouts     Int?
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
}

model custom_exercises {
  id             String           @id
  userId         String
  name           String
  bodyPart       String?
  equipment      String?
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  mediaUrl       String?
  users          users            @relation(fields: [userId], references: [id], onDelete: Cascade)
  personal_bests personal_bests[]
  workout_items  workout_items[]

  @@unique([userId, name])
  @@index([userId, name])
}

model exercises {
  id             String           @id
  name           String           @unique
  bodyPart       String?
  equipment      String?
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  mediaUrl       String?
  instructions   String?
  personal_bests personal_bests[]
  workout_items  workout_items[]
}

model faqs {
  id        String   @id
  question  String
  answer    String
  category  String?
  order     Int      @default(0)
  tags      String?
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model goals {
  id           String    @id
  userId       String
  title        String?
  description  String?
  targetDate   DateTime?
  targetValue  Float?
  currentValue Float     @default(0)
  unit         String?
  status       String    @default("active")
  category     String?
  type         String?
  targetInt    Int?
  targetDec    Float?
  period       String?
  startDate    DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  isActive     Boolean   @default(true)
  users        users     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model personal_bests {
  id               String            @id
  userId           String
  exerciseId       String?
  customId         String?
  type             String
  weightKg         Decimal?          @db.Decimal(6, 2)
  reps             Int?
  value            Decimal           @db.Decimal(6, 2)
  setId            String
  createdAt        DateTime          @default(now())
  custom_exercises custom_exercises? @relation(fields: [customId], references: [id], onDelete: Cascade)
  exercises        exercises?        @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  workout_sets     workout_sets      @relation(fields: [setId], references: [id], onDelete: Cascade)
  users            users             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([setId])
  @@index([userId, exerciseId, customId, type])
}

model reminders {
  id          String   @id
  userId      String
  title       String
  description String?
  scheduledAt DateTime
  completed   Boolean  @default(false)
  recurring   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model sessions {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_preferences {
  id                 String   @id
  userId             String   @unique
  defaultRestSeconds Int      @default(90)
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  users              users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model users {
  id               String             @id
  email            String             @unique
  emailVerified    DateTime?
  name             String?
  password         String?
  passwordHash     String?
  image            String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  themePreference  String?            @default("system")
  unitPreference   String?            @default("metric")
  accounts         accounts[]
  achievements     achievements[]
  activity_entries activity_entries[]
  custom_exercises custom_exercises[]
  goals            goals[]
  personal_bests   personal_bests[]
  reminders        reminders[]
  sessions         sessions[]
  user_preferences user_preferences?
  weight_logs      weight_logs[]
  workout_sessions workout_sessions[]
}

model weight_logs {
  id        String   @id
  userId    String
  weightKg  Decimal  @db.Decimal(5, 2)
  loggedAt  DateTime @default(now())
  note      String?
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, loggedAt])
}

model verification_tokens {
  id         String   @id
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model workout_items {
  id               String            @id
  workoutId        String
  exerciseId       String?
  orderIndex       Int               @default(0)
  customId         String?
  custom_exercises custom_exercises? @relation(fields: [customId], references: [id], onDelete: Restrict)
  exercises        exercises?        @relation(fields: [exerciseId], references: [id], onDelete: Restrict)
  workout_sessions workout_sessions  @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  workout_sets     workout_sets[]

  @@index([workoutId, orderIndex])
}

model workout_sessions {
  id            String          @id
  userId        String
  date          DateTime        @default(now())
  title         String?
  notes         String?
  durationMin   Int?
  createdAt     DateTime        @default(now())
  workout_items workout_items[]
  users         users           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
}

model workout_sets {
  id             String           @id
  itemId         String
  setNumber      Int
  weightKg       Decimal?         @db.Decimal(6, 2)
  reps           Int
  rpe            Decimal?         @db.Decimal(3, 1)
  notes          String?
  createdAt      DateTime         @default(now())
  personal_bests personal_bests[]
  workout_items  workout_items    @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([itemId, setNumber])
}
